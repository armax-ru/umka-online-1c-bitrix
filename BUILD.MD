# Сборка модуля

## Подготовка к сборке перед публикацией

### Composer
Если в проекте были установлены новые модули Composer, перед сборкой для публикации необходимо выполнить команду:
```
composer install --no-dev --optimize-autoloader
```
*  `--no-dev` пропускает установку зависимостей для разработки (например, библиотек для тестирования).  
*  `--optimize-autoloader` выполняет оптимизацию автозагрузчика (подробнее в [документации Composer](https://getcomposer.org/doc/articles/autoloader-optimization.md))

### Кодировка языковых файлов
Языковые файлы, раположеные в папке `/armax.umkaonline/lang/ru`, должны быть в кодировке `Windows-1251`. При установке из 1C-Bitrix Marketplace на сайт пользователя, они будут преобразованы к кодировке, которая используется на сайте пользователя.  
Так же, при разработке, следует придерживаться использования модуля локализации (см. `Bitrix\Main\Localization\Loc`);

### Описание обновления
При подготовке модуля к публикации необходимо создать файл `description.ru` в кодировке `Windows-1251` с описанием обновления.

### Обновление номера версии модуля
При подготовке модуля к публикации необходимо обновить версию и дату разрабатываемого модуля в файле `armax.umkaonline/install/version.php`

## Файловая структура для публикации
Обновление модуля состоит только из измененных файлов.  
Посмотреть, какие именно файлы были изменены можно с помощью команды:
```
git diff --name-only TAG|HASH TAG|HASH
```

### Структура файлов
  1. Создать папку с номером версии модуля по semver. (например, 1.2.3)
  2. Добавить файл `1.2.3/install/version.php`
  3. Добавить файл описания обновления `1.2.3/description.ru`
  4. Добавить обновленные файлы `1.2.3/lib/UmkaOnline.php`

Пример получившейся структуры файлов:
```
1.2.3/
├── description.ru
├── install
│   └── version.php
└── lib
    └── UmkaOnline.php
```

Данную папку необходимо заархивировать и назвать номером версии (например, `1.2.3.zip`)

* Руководство по обновлению: https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=101&LESSON_ID=3218&LESSON_PATH=8781.4793.3218

## Публикация модуля

Публикация модуля проиходит в личном кабинете партнера Маркетплейс 1С-Битрикс.
Раздел для управления версиями модулей и загрузки обновлений: https://partners.1c-bitrix.ru/personal/modules/update_module.php?ID=armax.umkaonline

После загрузки обновления рекомендуется установить тип обновления "Бета" для тестовой установки из 1C-Bitrix Marketplace на локальной версии сайта и/или bitrixlabs.ru